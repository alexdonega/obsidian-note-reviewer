---
wave: 2
depends_on: [02-02]
files_modified:
  - packages/annotation/src/types/Annotation.ts
  - packages/annotation/src/components/StatusBadge.tsx
  - packages/annotation/src/components/AnnotationStatusControls.tsx
  - packages/annotation/src/utils/statusHelpers.ts
autonomous: true
must_haves:
  - Status badge displays on annotation panel items
  - Status controls allow changing annotation status
  - Status changes persist to database
  - Visual indicators distinguish open/in-progress/resolved
  - Status changes track who changed and when
---

# Plan 02-03: Implement Status Tracking Workflow

## Objective
Implement status tracking workflow for annotations with three states: open, in-progress, and resolved.

## Context
Status tracking is part of Phase 2 requirements (ANNO-04).
- Use simple enum with transitions (not full state machine library)
- Track who changed status and when
- Allow any collaborator to change status (not just author)
- Store status in annotation record for history

## Tasks

### Task 1: Add status field to Annotation type
```xml
<task>
  <file>packages/annotation/src/types/Annotation.ts</file>
  <description>Extend Annotation interface with status tracking fields</description>
  <steps>
    1. Import AnnotationStatus enum (OPEN, IN_PROGRESS, RESOLVED)
    2. Add field: `status?: AnnotationStatus` to Annotation interface
    3. Add field: `resolvedAt?: number` - timestamp when resolved
    4. Add field: `resolvedBy?: string` - user ID who resolved it
    5. Update AnnotationStore to handle status changes
  </steps>
</task>
```

### Task 2: Create StatusBadge component
```xml
<task>
  <file>packages/annotation/src/components/StatusBadge.tsx</file>
  <description>Build badge component displaying annotation status</description>
  <steps>
    1. Create component accepting status prop
    2. Define status styles:
       - OPEN: gray bg, "Aberto" label
       - IN_PROGRESS: blue bg, "Em Progresso" label
       - RESOLVED: green bg, "Resolvido" label
    3. Add icon for each status (circle, loading, checkmark)
    4. Make badge clickable for quick status change
    5. Show small size in list, larger in detail view
  </steps>
</task>
```

### Task 3: Create AnnotationStatusControls component
```xml
<task>
  <file>packages/annotation/src/components/AnnotationStatusControls.tsx</file>
  <description>Build dropdown/controls for changing annotation status</description>
  <steps>
    1. Create component with three status option buttons
    2. Each button shows icon + label for status
    3. Active status highlighted visually
    4. On click, call updateAnnotationStatus action
    5. Add confirmation dialog for RESOLVED status (optional)
    6. Integrate with useAnnotationStore
  </steps>
</task>
```

### Task 4: Create status helper utilities
```xml
<task>
  <file>packages/annotation/src/utils/statusHelpers.ts</file>
  <description>Create utility functions for status operations</description>
  <steps>
    1. Create getStatusLabel(status) - returns Portuguese label
    2. Create getStatusColor(status) - returns CSS color class
    3. Create getStatusIcon(status) - returns React element for icon
    4. Create canChangeStatus(annotation, userId) - permission check
    5. Create getNextStatus(currentStatus) - suggests next status in workflow
  </steps>
</task>
```

### Task 5: Update AnnotationStore with status actions
```xml
<task>
  <file>packages/annotation/src/store/useAnnotationStore.ts</file>
  <description>Add status change actions to AnnotationStore</description>
  <steps>
    1. Add updateAnnotationStatus(id, status, userId) action
    2. Set resolvedAt timestamp when status becomes RESOLVED
    3. Set resolvedBy to userId when status becomes RESOLVED
    4. Clear resolvedAt/resolvedBy when status changes from RESOLVED
    5. Persist status change to Supabase
    6. Emit event for status change notification (future)
  </steps>
</task>
```

## Verification
- [ ] Status badge displays on annotation panel items
- [ ] Status controls allow changing annotation status
- [ ] Status changes persist to database
- [ ] Visual indicators distinguish open/in-progress/resolved
- [ ] Status changes track who changed and when
